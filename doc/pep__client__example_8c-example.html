<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Argus PEP client API: pep_client_example.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>pep_client_example.c</h1><p>This is an example how to use the PEP client.</p>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> * Copyright (c) Members of the EGEE Collaboration. 2006-2010.</span>
<span class="comment"> * See http://www.eu-egee.org/partners/ for details on the copyright holders.</span>
<span class="comment"> *</span>
<span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="comment"> * you may not use this file except in compliance with the License.</span>
<span class="comment"> * You may obtain a copy of the License at</span>
<span class="comment"> *</span>
<span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="comment"> *</span>
<span class="comment"> * Unless required by applicable law or agreed to in writing, software</span>
<span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="comment"> * See the License for the specific language governing permissions and</span>
<span class="comment"> * limitations under the License.</span>
<span class="comment"> */</span>

<span class="comment">/*************</span>
<span class="comment"> * Simple Argus PEP client example</span>
<span class="comment"> *</span>
<span class="comment"> * gcc -I/usr/include -L/usr/lib64 -largus-pep pep_client_example.c -o pep_client_example</span>
<span class="comment"> *</span>
<span class="comment"> * or use &quot;pkg-config libargus-pep --cflags --libs&quot; to dertermine the required CFLAGS and </span>
<span class="comment"> * LDFLAGS.</span>
<span class="comment"> *</span>
<span class="comment"> * Author: Valery Tschopp &lt;valery.tschopp@switch.ch&gt;</span>
<span class="comment"> * $Id$</span>
<span class="comment"> ************/</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>

<span class="comment">/* include Argus PEP client API header */</span>
<span class="preprocessor">#include &lt;<a class="code" href="pep_8h.html">argus/pep.h</a>&gt;</span>

<span class="comment">/* prototypes */</span>
<span class="keyword">static</span> <span class="keywordtype">int</span> create_xacml_request(<a name="a0"></a><a class="code" href="group___x_a_c_m_l.html#gaac84829d17576c571cd47f66964fc041" title="PEP XACML Request type.">xacml_request_t</a> ** request,<span class="keyword">const</span> <span class="keywordtype">char</span> * subjectid, <span class="keyword">const</span> <span class="keywordtype">char</span> * resourceid, <span class="keyword">const</span> <span class="keywordtype">char</span> * actionid);
<span class="keyword">static</span> <span class="keywordtype">int</span> process_xacml_response(<span class="keyword">const</span> <a name="a1"></a><a class="code" href="group___x_a_c_m_l.html#gae9efa98ca44c901033c092c21502a555" title="PEP XACML Response type.">xacml_response_t</a> * response);
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * decision_tostring(<a name="a2"></a><a class="code" href="group___x_a_c_m_l.html#ga6729844bd65b70c7ae7f897531907d9b" title="PEP XACML Result/Decision element constants.">xacml_decision_t</a> decision);
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * fulfillon_tostring(<a name="a3"></a><a class="code" href="group___x_a_c_m_l.html#gab33cf1ceccba4f38379b43086155d4b9" title="PEP XACML Obligation/@FulfillOn attribute constants.">xacml_fulfillon_t</a> fulfillon);

<span class="comment">/*</span>
<span class="comment"> * main</span>
<span class="comment"> */</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {

    <span class="comment">/* Argus PEP client handle */</span>
    <a name="a4"></a><a class="code" href="group___p_e_p_client.html#ga4f16e342e83ca3db8268328949e95cf4" title="PEP client handle.">PEP</a> * pep;

    <span class="comment">/* functions return code */</span>
    <a class="code" href="group___error.html#gaa19c242e7476501a56c676af7da38ad4" title="PEP client error codes.">pep_error_t</a> pep_rc; <span class="comment">/* PEP function error */</span>
    <span class="keywordtype">int</span> rc;             <span class="comment">/* others functions */</span>
    
    <span class="comment">/* XACML request and response */</span>
    <a class="code" href="group___x_a_c_m_l.html#gaac84829d17576c571cd47f66964fc041" title="PEP XACML Request type.">xacml_request_t</a> * request;
    <a class="code" href="group___x_a_c_m_l.html#gae9efa98ca44c901033c092c21502a555" title="PEP XACML Response type.">xacml_response_t</a> * response;

    <span class="keywordtype">char</span> * pep_url, * subjectid, * resourceid, * actionid;

    <span class="comment">/* dump library version */</span>
    fprintf(stdout,<span class="stringliteral">&quot;using %s\n&quot;</span>,<a name="a5"></a><a class="code" href="group___p_e_p_client.html#gad1882cccbf3d1ec9597ea5687227eb99" title="Returns a human readable string with the version number of the PEP client API and...">pep_version</a>());

    
    <span class="comment">/* create the PEP client handle */</span>
    pep= <a name="a6"></a><a class="code" href="group___p_e_p_client.html#gafb4ea12b710314c0f99f3864f3711fd2" title="Creates and initializes a new PEP client handle.">pep_initialize</a>();
    <span class="keywordflow">if</span> (pep == NULL) {
       fprintf(stderr,<span class="stringliteral">&quot;failed to create PEP client\n&quot;</span>);
       exit(1);
    }

    <span class="comment">/* debugging options */</span>
    <a name="a7"></a><a class="code" href="group___p_e_p_client.html#ga518312b2b065b23ea8e0b2bedfd4c411" title="Sets a PEP client configuration option.">pep_setoption</a>(pep,<a name="a8"></a><a class="code" href="group___p_e_p_client.html#gga68c076cdb8a9174a88a71835c19a8938a9e34537cfdde4c5ce63a08b213bfeae6" title="Set log engine file descriptor: stderr, stdout, NULL (default NULL).">PEP_OPTION_LOG_STDERR</a>,stderr);
    <a class="code" href="group___p_e_p_client.html#ga518312b2b065b23ea8e0b2bedfd4c411" title="Sets a PEP client configuration option.">pep_setoption</a>(pep,<a name="a9"></a><a class="code" href="group___p_e_p_client.html#gga68c076cdb8a9174a88a71835c19a8938a6c49e98854d7a3becf83514a758ae0f5" title="Set log level (default PEP_LOGLEVEL_NONE).">PEP_OPTION_LOG_LEVEL</a>,<a name="a10"></a><a class="code" href="group___logging.html#ga7ece368b13fd328387a7341dff1c6794" title="Logs ERROR, WARN, INFO and DEBUG messages.">PEP_LOGLEVEL_DEBUG</a>);

    <span class="comment">/* configure PEP client: PEP Server endpoint url */</span>
    pep_url= <span class="stringliteral">&quot;https://chaos.switch.ch:8154/authz&quot;</span>;
    pep_rc= <a class="code" href="group___p_e_p_client.html#ga518312b2b065b23ea8e0b2bedfd4c411" title="Sets a PEP client configuration option.">pep_setoption</a>(pep,<a name="a11"></a><a class="code" href="group___p_e_p_client.html#gga68c076cdb8a9174a88a71835c19a8938a39cc0ea8c9ce10200ad64e7d45283c29" title="Set the mandatory PEP daemon endpoint URL.">PEP_OPTION_ENDPOINT_URL</a>,pep_url);
    <span class="keywordflow">if</span> (pep_rc != <a name="a12"></a><a class="code" href="group___error.html#ggaa19c242e7476501a56c676af7da38ad4af551b86f6d7bcd55ed4420c21a39ed9b" title="OK, No error.">PEP_OK</a>) {
       fprintf(stderr,<span class="stringliteral">&quot;failed to set PEP endpoint: %s: %s\n&quot;</span>, pep_url, <a name="a13"></a><a class="code" href="group___error.html#ga0ae03e0c7efd0530287e705e7b139972" title="Gets the string describing the error number errno.">pep_strerror</a>(pep_rc));
       exit(1);
    }   
    <span class="comment">/* configure PEP client: private key and certificate required to access the PEP Server */</span>
    <span class="comment">/* endpoint (HTTPS with client authentication) */</span>
    pep_rc= <a class="code" href="group___p_e_p_client.html#ga518312b2b065b23ea8e0b2bedfd4c411" title="Sets a PEP client configuration option.">pep_setoption</a>(pep,<a name="a14"></a><a class="code" href="group___p_e_p_client.html#gga68c076cdb8a9174a88a71835c19a8938ab0d8bbc94fe747c7c3712db2f8651502" title="PEP client SSL private key (PEM format) for client authN: absolute filename.">PEP_OPTION_ENDPOINT_CLIENT_KEY</a>,<span class="stringliteral">&quot;/etc/grid-security/hostkey.pem&quot;</span>);
    <span class="keywordflow">if</span> (pep_rc != <a class="code" href="group___error.html#ggaa19c242e7476501a56c676af7da38ad4af551b86f6d7bcd55ed4420c21a39ed9b" title="OK, No error.">PEP_OK</a>) {
       fprintf(stderr,<span class="stringliteral">&quot;failed to set client key: %s: %s\n&quot;</span>, <span class="stringliteral">&quot;/etc/grid-security/hostkey.pem&quot;</span>, <a class="code" href="group___error.html#ga0ae03e0c7efd0530287e705e7b139972" title="Gets the string describing the error number errno.">pep_strerror</a>(pep_rc));
       exit(1);
    }   
    pep_rc= <a class="code" href="group___p_e_p_client.html#ga518312b2b065b23ea8e0b2bedfd4c411" title="Sets a PEP client configuration option.">pep_setoption</a>(pep,<a name="a15"></a><a class="code" href="group___p_e_p_client.html#gga68c076cdb8a9174a88a71835c19a8938a8cabb15f956b68914cd3001040049636" title="PEP client SSL certificate (PEM format) for client authN: absolute filename.">PEP_OPTION_ENDPOINT_CLIENT_CERT</a>,<span class="stringliteral">&quot;/etc/grid-security/hostcert.pem&quot;</span>);
    <span class="keywordflow">if</span> (pep_rc != <a class="code" href="group___error.html#ggaa19c242e7476501a56c676af7da38ad4af551b86f6d7bcd55ed4420c21a39ed9b" title="OK, No error.">PEP_OK</a>) {
       fprintf(stderr,<span class="stringliteral">&quot;failed to set client cert: %s: %s\n&quot;</span>, <span class="stringliteral">&quot;/etc/grid-security/hostcert.pem&quot;</span>, <a class="code" href="group___error.html#ga0ae03e0c7efd0530287e705e7b139972" title="Gets the string describing the error number errno.">pep_strerror</a>(pep_rc));
       exit(1);
    }   
    <span class="comment">/* server certificate CA path for validation */</span>
    pep_rc= <a class="code" href="group___p_e_p_client.html#ga518312b2b065b23ea8e0b2bedfd4c411" title="Sets a PEP client configuration option.">pep_setoption</a>(pep,<a name="a16"></a><a class="code" href="group___p_e_p_client.html#gga68c076cdb8a9174a88a71835c19a8938af76d7696abb8fe9282b0ad62dd4bc068" title="Directory holding CA certificates (hashed filenames in PEM format) to verify the...">PEP_OPTION_ENDPOINT_SERVER_CAPATH</a>,<span class="stringliteral">&quot;/etc/grid-security/certificates&quot;</span>);
    <span class="keywordflow">if</span> (pep_rc != <a class="code" href="group___error.html#ggaa19c242e7476501a56c676af7da38ad4af551b86f6d7bcd55ed4420c21a39ed9b" title="OK, No error.">PEP_OK</a>) {
       fprintf(stderr,<span class="stringliteral">&quot;failed to set server CA path: %s: %s\n&quot;</span>, <span class="stringliteral">&quot;/etc/grid-security/certificates&quot;</span>, <a class="code" href="group___error.html#ga0ae03e0c7efd0530287e705e7b139972" title="Gets the string describing the error number errno.">pep_strerror</a>(pep_rc));
       exit(1);
    }   

    <span class="comment">/* create the XACML request */</span>
    subjectid= <span class="stringliteral">&quot;CN=Valery Tschopp 9FEE5EE3,O=Switch - Teleinformatikdienste fuer Lehre und Forschung,DC=slcs,DC=switch,DC=ch&quot;</span>;
    resourceid= <span class="stringliteral">&quot;switch&quot;</span>;
    actionid= <span class="stringliteral">&quot;switch&quot;</span>;
    rc= create_xacml_request(&amp;request,subjectid,resourceid,actionid);
    <span class="keywordflow">if</span> (rc != 0) {
       fprintf(stderr,<span class="stringliteral">&quot;failed to create XACML request\n&quot;</span>);
       exit(1);
    }

    <span class="comment">/* submit the XACML request */</span>
    pep_rc= <a name="a17"></a><a class="code" href="group___p_e_p_client.html#ga27a6e8559b4d2759d72b31fc3064527f" title="Sends the XACML request to the PEP daemon and returns the XACML response.">pep_authorize</a>(pep,&amp;request, &amp;response);
    <span class="keywordflow">if</span> (pep_rc != <a class="code" href="group___error.html#ggaa19c242e7476501a56c676af7da38ad4af551b86f6d7bcd55ed4420c21a39ed9b" title="OK, No error.">PEP_OK</a>) {
       fprintf(stderr,<span class="stringliteral">&quot;failed to authorize XACML request: %s\n&quot;</span>, <a class="code" href="group___error.html#ga0ae03e0c7efd0530287e705e7b139972" title="Gets the string describing the error number errno.">pep_strerror</a>(pep_rc));
       exit(1);
    }   
    
    <span class="comment">/* parse and process XACML response */</span>
    rc= process_xacml_response(response);
    
    <span class="comment">/* delete resquest and response objs */</span>
    <a name="a18"></a><a class="code" href="group___x_a_c_m_l.html#gaa8d740048404e44861e29232c1787316" title="Deletes the XACML Request.">xacml_request_delete</a>(request);
    <a name="a19"></a><a class="code" href="group___x_a_c_m_l.html#ga4ac3d5635ecd13417a75b449605ba65c" title="Deletes the XACML Response.">xacml_response_delete</a>(response);
        
    <span class="comment">/* release the PEP client handle */</span>
    <a name="a20"></a><a class="code" href="group___p_e_p_client.html#gae679df01a78429727507872d76d3812f" title="Cleanups and destroys the PEP client.">pep_destroy</a>(pep);

    <span class="keywordflow">return</span> 0;
}

<span class="comment">/*</span>
<span class="comment"> * Creates a XACML Request containing a XACML Subject with the given subjectid, a XACML Resource</span>
<span class="comment"> * with the given resourceid and a XACML Action with the given actionid.</span>
<span class="comment"> * </span>
<span class="comment"> * @param [in/out] request address of the pointer to the XACML request object</span>
<span class="comment"> * @param [in] subjectid, a X.509 DN, attribute value of the XACML Request/Subject element </span>
<span class="comment"> * @param [in] resourceid  attribute value of the XACML Request/Resource element</span>
<span class="comment"> * @param [in] actionid  attribute value of the XACML Request/Action element</span>
<span class="comment"> * @return 0 on success or error code on failure.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <span class="keywordtype">int</span> create_xacml_request(<a class="code" href="group___x_a_c_m_l.html#gaac84829d17576c571cd47f66964fc041" title="PEP XACML Request type.">xacml_request_t</a> ** request,<span class="keyword">const</span> <span class="keywordtype">char</span> * subjectid, <span class="keyword">const</span> <span class="keywordtype">char</span> * resourceid, <span class="keyword">const</span> <span class="keywordtype">char</span> * actionid)
{
    <a name="a21"></a><a class="code" href="group___x_a_c_m_l.html#ga25413186b72f34d539e50d8b43fcf664">xacml_subject_t</a> * subject;
    <a name="a22"></a><a class="code" href="group___x_a_c_m_l.html#gab988fa9fb94d407e70171314553469e3">xacml_attribute_t</a> * subject_attr_id;
    <a name="a23"></a><a class="code" href="group___x_a_c_m_l.html#ga751fbd56c6cc8945729320028f290398" title="PEP XACML Resource type.">xacml_resource_t</a> * resource;
    <a class="code" href="group___x_a_c_m_l.html#gab988fa9fb94d407e70171314553469e3">xacml_attribute_t</a> * resource_attr_id;
    <a name="a24"></a><a class="code" href="group___x_a_c_m_l.html#gaa086cdd425533ce353f07b5f35280313" title="PEP XACML Action type.">xacml_action_t</a> * action;
    <a class="code" href="group___x_a_c_m_l.html#gab988fa9fb94d407e70171314553469e3">xacml_attribute_t</a> * action_attr_id;
    
    <span class="comment">/* XACML Subject with subjectid Attribute value */</span>
    subject= <a name="a25"></a><a class="code" href="group___x_a_c_m_l.html#ga72e5227f7a16d79d6c80876ea221a044" title="Creates a XACML Subject.">xacml_subject_create</a>();
    <span class="keywordflow">if</span> (subject == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;can not create XACML Subject\n&quot;</span>);
        <span class="keywordflow">return</span> 1;
    }
    subject_attr_id= <a name="a26"></a><a class="code" href="group___x_a_c_m_l.html#ga57aca8f7c9869bf1ac6d862c28bea60f" title="Creates and initializes a XACML Attribute.">xacml_attribute_create</a>(<a name="a27"></a><a class="code" href="group___x_a_c_m_l.html#ga7c497f8acc4ee9cc7b92689d7abfdcfe" title="XACML Subject/Attribute subject-id identifier (XACML 2.0, B.4).">XACML_SUBJECT_ID</a>);
    <span class="keywordflow">if</span> (subject_attr_id == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;can not create XACML Subject/Attribute:%s\n&quot;</span>,<a class="code" href="group___x_a_c_m_l.html#ga7c497f8acc4ee9cc7b92689d7abfdcfe" title="XACML Subject/Attribute subject-id identifier (XACML 2.0, B.4).">XACML_SUBJECT_ID</a>);
        <a name="a28"></a><a class="code" href="group___x_a_c_m_l.html#ga6dc6fa5ed884f4c7553a69bee4b2c83f" title="Deletes the XACML Subject.">xacml_subject_delete</a>(subject);
        <span class="keywordflow">return</span> 1;
    }
    <span class="comment">// set X.509 DN value</span>
    <a name="a29"></a><a class="code" href="group___x_a_c_m_l.html#gab96c76664e5241984d6f5c0af7836e18" title="Adds a value element to the XACML Attribute.">xacml_attribute_addvalue</a>(subject_attr_id,subjectid);
    <span class="comment">// set attribute datatype for X.509 DN</span>
    <a name="a30"></a><a class="code" href="group___x_a_c_m_l.html#ga1974c65fffcd6904a928307ae2becffd" title="Sets the datatype attribute of the XACML Attribute.">xacml_attribute_setdatatype</a>(subject_attr_id,<a name="a31"></a><a class="code" href="group___x_a_c_m_l.html#ga2fe9cf9a927586b39a38dfbf441edfc5" title="XACML data-type x500Name identifier (XACML 2.0, B.3).">XACML_DATATYPE_X500NAME</a>); 
    <a name="a32"></a><a class="code" href="group___x_a_c_m_l.html#gadb7d19fcf4f0d48aeafb46671738b701" title="Adds a XACML Attribute to the Subject.">xacml_subject_addattribute</a>(subject,subject_attr_id);

    <span class="comment">/* XACML Resource with resourceid Attribute value */</span>
    resource= <a name="a33"></a><a class="code" href="group___x_a_c_m_l.html#ga7fe47a995da3e0829c843e8bdaa68030" title="Creates a XACML Resource.">xacml_resource_create</a>();
    <span class="keywordflow">if</span> (resource == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;can not create XACML Resource\n&quot;</span>);
        <a class="code" href="group___x_a_c_m_l.html#ga6dc6fa5ed884f4c7553a69bee4b2c83f" title="Deletes the XACML Subject.">xacml_subject_delete</a>(subject);
        <span class="keywordflow">return</span> 2;
    }
    resource_attr_id= <a class="code" href="group___x_a_c_m_l.html#ga57aca8f7c9869bf1ac6d862c28bea60f" title="Creates and initializes a XACML Attribute.">xacml_attribute_create</a>(<a name="a34"></a><a class="code" href="group___x_a_c_m_l.html#ga35db663a485c2a1e42f07b6e7f6f92d3" title="XACML Resource/Attribute resource-id identifier (XACML 2.0, B.6).">XACML_RESOURCE_ID</a>);
    <span class="keywordflow">if</span> (resource_attr_id == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;can not create XACML Resource/Attribute:%s\n&quot;</span>,<a class="code" href="group___x_a_c_m_l.html#ga35db663a485c2a1e42f07b6e7f6f92d3" title="XACML Resource/Attribute resource-id identifier (XACML 2.0, B.6).">XACML_RESOURCE_ID</a>);
        <a class="code" href="group___x_a_c_m_l.html#ga6dc6fa5ed884f4c7553a69bee4b2c83f" title="Deletes the XACML Subject.">xacml_subject_delete</a>(subject);
        <a name="a35"></a><a class="code" href="group___x_a_c_m_l.html#ga34bbbd7d25c0398f18ec7072f2fc5989" title="Deletes the XACML Resource.">xacml_resource_delete</a>(resource);
        <span class="keywordflow">return</span> 2;
    }
    <a class="code" href="group___x_a_c_m_l.html#gab96c76664e5241984d6f5c0af7836e18" title="Adds a value element to the XACML Attribute.">xacml_attribute_addvalue</a>(resource_attr_id,resourceid);
    <a name="a36"></a><a class="code" href="group___x_a_c_m_l.html#gaedaae39b7ec088835d4f7f8c179b3f57" title="Adds a XACML Attribute to the XACML Resource.">xacml_resource_addattribute</a>(resource,resource_attr_id);

    <span class="comment">/* XACML Action with actionid Attribute value */</span>
    action= <a name="a37"></a><a class="code" href="group___x_a_c_m_l.html#ga908bfccfb733e5fa6bc536cbd1cf1049" title="Creates a XACML Action.">xacml_action_create</a>();
    <span class="keywordflow">if</span> (action == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;can not create XACML Action\n&quot;</span>);
        <a class="code" href="group___x_a_c_m_l.html#ga6dc6fa5ed884f4c7553a69bee4b2c83f" title="Deletes the XACML Subject.">xacml_subject_delete</a>(subject);
        <a class="code" href="group___x_a_c_m_l.html#ga34bbbd7d25c0398f18ec7072f2fc5989" title="Deletes the XACML Resource.">xacml_resource_delete</a>(resource);
        <span class="keywordflow">return</span> 3;
    }
    action_attr_id= <a class="code" href="group___x_a_c_m_l.html#ga57aca8f7c9869bf1ac6d862c28bea60f" title="Creates and initializes a XACML Attribute.">xacml_attribute_create</a>(<a name="a38"></a><a class="code" href="group___x_a_c_m_l.html#ga592968b29f4f16ab756ee74663391102" title="XACML Action/Attribute action-id identifier (XACML 2.0, B.7).">XACML_ACTION_ID</a>);
    <span class="keywordflow">if</span> (action_attr_id == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;can not create XACML Action/Attribute:%s\n&quot;</span>,<a class="code" href="group___x_a_c_m_l.html#ga592968b29f4f16ab756ee74663391102" title="XACML Action/Attribute action-id identifier (XACML 2.0, B.7).">XACML_ACTION_ID</a>);
        <a class="code" href="group___x_a_c_m_l.html#ga6dc6fa5ed884f4c7553a69bee4b2c83f" title="Deletes the XACML Subject.">xacml_subject_delete</a>(subject);
        <a class="code" href="group___x_a_c_m_l.html#ga34bbbd7d25c0398f18ec7072f2fc5989" title="Deletes the XACML Resource.">xacml_resource_delete</a>(resource);
        <a name="a39"></a><a class="code" href="group___x_a_c_m_l.html#ga83415ab6b9fe22015a11cd25233212cc" title="Deletes the XACML Action.">xacml_action_delete</a>(action);
        <span class="keywordflow">return</span> 3;
    }
    <a class="code" href="group___x_a_c_m_l.html#gab96c76664e5241984d6f5c0af7836e18" title="Adds a value element to the XACML Attribute.">xacml_attribute_addvalue</a>(action_attr_id,actionid);
    <a name="a40"></a><a class="code" href="group___x_a_c_m_l.html#ga448175c786808749c4438a326c92a604" title="Adds a XACML Attribute to the XACML Action.">xacml_action_addattribute</a>(action,action_attr_id);

    <span class="comment">/* XACML Request with all elements */</span>
    *request= <a name="a41"></a><a class="code" href="group___x_a_c_m_l.html#ga1d85205cb939e3b3df31fbce727e6f1f" title="Creates a XACML Request.">xacml_request_create</a>();
    <span class="keywordflow">if</span> (*request == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;can not create XACML Request\n&quot;</span>);
        <a class="code" href="group___x_a_c_m_l.html#ga6dc6fa5ed884f4c7553a69bee4b2c83f" title="Deletes the XACML Subject.">xacml_subject_delete</a>(subject);
        <a class="code" href="group___x_a_c_m_l.html#ga34bbbd7d25c0398f18ec7072f2fc5989" title="Deletes the XACML Resource.">xacml_resource_delete</a>(resource);
        <a class="code" href="group___x_a_c_m_l.html#ga83415ab6b9fe22015a11cd25233212cc" title="Deletes the XACML Action.">xacml_action_delete</a>(action);
        <span class="keywordflow">return</span> 4;
    }
    <a name="a42"></a><a class="code" href="group___x_a_c_m_l.html#ga8a57d793c44804f1632cef66908311be" title="Adds a XACML Subject to the XACML Request.">xacml_request_addsubject</a>(*request,subject);
    <a name="a43"></a><a class="code" href="group___x_a_c_m_l.html#ga618d7aa0af63a551427be5a0bc1c4fe9" title="Adds a XACML Resource to the XACML Request.">xacml_request_addresource</a>(*request,resource);
    <a name="a44"></a><a class="code" href="group___x_a_c_m_l.html#ga9ea41c7f29cfbd039ae43042faeb787d" title="Sets a XACML Action for the XACML Request.">xacml_request_setaction</a>(*request,action);
    
    <span class="keywordflow">return</span> 0;
}

<span class="comment">/*</span>
<span class="comment"> * Simply dump the XACML response.</span>
<span class="comment"> *</span>
<span class="comment"> * @param [in] response the XAXML response</span>
<span class="comment"> * @return 0 on success or error code on failure. </span>
<span class="comment"> */</span>
<span class="keyword">static</span> <span class="keywordtype">int</span> process_xacml_response(<span class="keyword">const</span> <a class="code" href="group___x_a_c_m_l.html#gae9efa98ca44c901033c092c21502a555" title="PEP XACML Response type.">xacml_response_t</a> * response) {
    <span class="keywordtype">size_t</span> results_l;
    <span class="keywordtype">int</span> i, j, k;
    <span class="keywordflow">if</span> (response == NULL) {
        fprintf(stderr,<span class="stringliteral">&quot;response is NULL\n&quot;</span>);
        <span class="keywordflow">return</span> 1;
    }
    results_l= <a name="a45"></a><a class="code" href="group___x_a_c_m_l.html#ga7fb22b46325dd194401d7a2e29e7375a" title="Returns the number of XACML Result in the XACML Response.">xacml_response_results_length</a>(response);
    fprintf(stdout,<span class="stringliteral">&quot;response: %d results\n&quot;</span>, (<span class="keywordtype">int</span>)results_l);
    <span class="keywordflow">for</span>(i= 0; i&lt;results_l; i++) {
        <a name="a46"></a><a class="code" href="group___x_a_c_m_l.html#gad409acd7173bd3503ef87a0fc7191d77" title="PEP XACML Result type.">xacml_result_t</a> * result;
        <a name="a47"></a><a class="code" href="group___x_a_c_m_l.html#ga19e2d22353893f1079e146c1f3a2abf4" title="PEP XACML Status type.">xacml_status_t</a> * status;
        <a name="a48"></a><a class="code" href="group___x_a_c_m_l.html#ga3453af6909941fab83ff22bb6ce6989b" title="PEP XACML StatusCode type.">xacml_statuscode_t</a> * statuscode, * subcode;
        <span class="keywordtype">size_t</span> obligations_l;
        
        result= <a name="a49"></a><a class="code" href="group___x_a_c_m_l.html#ga350aea3939102120985306022d383a02" title="Gets the XACML Result from the XACML Response at the given index.">xacml_response_getresult</a>(response,i);
        fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].decision= %s\n&quot;</span>, i, decision_tostring(<a name="a50"></a><a class="code" href="group___x_a_c_m_l.html#gacdefd2b47087eebdbc7e0e9193e290ff" title="Gets the XACML Result/Decision value.">xacml_result_getdecision</a>(result)));
        fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].resourceid= %s\n&quot;</span>, i, <a name="a51"></a><a class="code" href="group___x_a_c_m_l.html#ga7af7fa5fdac50bd3b842a57992bcb2d9" title="Gets the XACML Result/@ResourceId attribute.">xacml_result_getresourceid</a>(result));
        
        status= <a name="a52"></a><a class="code" href="group___x_a_c_m_l.html#gaeddcc9ea3c42d1fe3e5f8f5006c8afaf" title="Gets the XACML Status from Result.">xacml_result_getstatus</a>(result);
        fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].status.message= %s\n&quot;</span>, i, <a name="a53"></a><a class="code" href="group___x_a_c_m_l.html#ga106184eb478d19b5ac05fbe72f83632c" title="Gets the XACML Status/StatusMessage element (string).">xacml_status_getmessage</a>(status));
        statuscode= <a name="a54"></a><a class="code" href="group___x_a_c_m_l.html#ga15b7c7ebee93afe1bea8206f163d499d" title="Gets the XACML StatusCode for this XACML Status.">xacml_status_getcode</a>(status);
        fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].status.code.value= %s\n&quot;</span>, i, <a name="a55"></a><a class="code" href="group___x_a_c_m_l.html#gab6cadca721d7277f39c29387617b68e1" title="Gets the XACML StatusCode/@Value attribute.">xacml_statuscode_getvalue</a>(statuscode));
        subcode= <a name="a56"></a><a class="code" href="group___x_a_c_m_l.html#ga7a50a68831a12a3f98cedf572df88492" title="Gets the minor XACML StatusCode for this XACML StatusCode.">xacml_statuscode_getsubcode</a>(statuscode);
        <span class="keywordflow">if</span> (subcode != NULL) {
            fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].status.code.subcode.value= %s\n&quot;</span>, i, <a class="code" href="group___x_a_c_m_l.html#gab6cadca721d7277f39c29387617b68e1" title="Gets the XACML StatusCode/@Value attribute.">xacml_statuscode_getvalue</a>(subcode));
        }
        obligations_l= <a name="a57"></a><a class="code" href="group___x_a_c_m_l.html#ga9fe1bd91205b313f992ae20c2ee2b78d" title="Returns the number of XACML Obligation in the XACML Result.">xacml_result_obligations_length</a>(result);
        fprintf(stdout,<span class="stringliteral">&quot;response.result[%d]: %d obligations\n&quot;</span>, i, (<span class="keywordtype">int</span>)obligations_l);
        <span class="keywordflow">for</span>(j= 0; j&lt;obligations_l; j++) {
            <span class="keywordtype">size_t</span> attrs_l;
            <a name="a58"></a><a class="code" href="group___x_a_c_m_l.html#ga0330c66c1e25c4b5c15d231356e11d6f" title="PEP XACML Obligation type.">xacml_obligation_t</a> * obligation= <a name="a59"></a><a class="code" href="group___x_a_c_m_l.html#ga6d33cc2026272391fc19f580a14fe3e4" title="Gets the XACML Obligation from the XACML Result at the given index.">xacml_result_getobligation</a>(result,j);
            fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].obligation[%d].id= %s\n&quot;</span>,i,j, <a name="a60"></a><a class="code" href="group___x_a_c_m_l.html#ga0fbdc51b01a36835a9e51b53714fcaad" title="Gets the XACML Obligation/@ObligationId attribute.">xacml_obligation_getid</a>(obligation));
            fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].obligation[%d].fulfillOn= %s\n&quot;</span>,i,j, fulfillon_tostring(<a name="a61"></a><a class="code" href="group___x_a_c_m_l.html#ga9827d4bddb56e79b0fcf0c3b340c87c2" title="Gets the XACML Obligation/@FulfillOn attribute.">xacml_obligation_getfulfillon</a>(obligation)));
            attrs_l= <a name="a62"></a><a class="code" href="group___x_a_c_m_l.html#gadd5e67b25d0ee20e3de45f4b4a34c40a" title="Returns the number of XACML AttributeAssignment in the XACML Obligation.">xacml_obligation_attributeassignments_length</a>(obligation);
            fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].obligation[%d]: %d attribute assignments\n&quot;</span>,i,j,(<span class="keywordtype">int</span>)attrs_l);
            <span class="keywordflow">for</span> (k= 0; k&lt;attrs_l; k++) {
                <a name="a63"></a><a class="code" href="group___x_a_c_m_l.html#ga0f04205747088575f92d9c9d94dfd709" title="PEP XACML AttributeAssignment type.">xacml_attributeassignment_t</a> * attr= <a name="a64"></a><a class="code" href="group___x_a_c_m_l.html#gac8c836dd91d4de8bc8c21b2403ff77a7" title="Gets the XACML AttributeAssignment from the Obligation at the given index.">xacml_obligation_getattributeassignment</a>(obligation,k);
                fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].obligation[%d].attributeassignment[%d].id= %s\n&quot;</span>,i,j,k,<a name="a65"></a><a class="code" href="group___x_a_c_m_l.html#ga034fc8e6fe0179995e6459774f6bc9a7" title="Gets the XACML AttributeAssignment/@AttributeId attribute.">xacml_attributeassignment_getid</a>(attr));
                fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].obligation[%d].attributeassignment[%d].datatype= %s\n&quot;</span>,i,j,k,<a name="a66"></a><a class="code" href="group___x_a_c_m_l.html#ga9c0c575a666ec21af6596c63c326aa6c" title="Gets the XACML AttributeAssignment/@DataType attribute.">xacml_attributeassignment_getdatatype</a>(attr));
                fprintf(stdout,<span class="stringliteral">&quot;response.result[%d].obligation[%d].attributeassignment[%d].value= %s\n&quot;</span>,i,j,k,<a name="a67"></a><a class="code" href="group___x_a_c_m_l.html#ga455adf35ae8c2ccf7daeffea527cf944" title="Gets the value from the XACML AttributeAssignment.">xacml_attributeassignment_getvalue</a>(attr));
            }
        }
    }
    <span class="keywordflow">return</span> 0;
}

<span class="comment">/*</span>
<span class="comment"> * Returns the string representation of the decision.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * decision_tostring(<a class="code" href="group___x_a_c_m_l.html#ga6729844bd65b70c7ae7f897531907d9b" title="PEP XACML Result/Decision element constants.">xacml_decision_t</a> decision) {
    <span class="keywordflow">switch</span>(decision) {
    <span class="keywordflow">case</span> <a name="a68"></a><a class="code" href="group___x_a_c_m_l.html#ggad62f2b4bb1bbaf42af129b7deb8fb6bda05052a2c1b91f21acdd7e5a73d400246" title="Decision is Deny.">XACML_DECISION_DENY</a>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Deny&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a name="a69"></a><a class="code" href="group___x_a_c_m_l.html#ggad62f2b4bb1bbaf42af129b7deb8fb6bdad5053fe2b36bbe4b698629073800cac7" title="Decision is Permit.">XACML_DECISION_PERMIT</a>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Permit&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a name="a70"></a><a class="code" href="group___x_a_c_m_l.html#ggad62f2b4bb1bbaf42af129b7deb8fb6bdaffa05e4ca9854850a9d405a0f6a74da4" title="Decision is Indeterminate, the PEP was unable to evaluate the request.">XACML_DECISION_INDETERMINATE</a>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Indeterminate&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a name="a71"></a><a class="code" href="group___x_a_c_m_l.html#ggad62f2b4bb1bbaf42af129b7deb8fb6bdaaaec51fbce76ae7dd82b8a6c9ed9d613" title="Decision is NotApplicable, the PEP does not have any policy that applies to the request...">XACML_DECISION_NOT_APPLICABLE</a>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Applicable&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;ERROR (Unknown Decision)&quot;</span>;
        <span class="keywordflow">break</span>;
    }
}

<span class="comment">/*</span>
<span class="comment"> * Returns the string representation of the fulfillOn.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * fulfillon_tostring(<a class="code" href="group___x_a_c_m_l.html#gab33cf1ceccba4f38379b43086155d4b9" title="PEP XACML Obligation/@FulfillOn attribute constants.">xacml_fulfillon_t</a> fulfillon) {
    <span class="keywordflow">switch</span>(fulfillon) {
    <span class="keywordflow">case</span> <a name="a72"></a><a class="code" href="group___x_a_c_m_l.html#gga5f41d6a06e5c9c7c1d540da86e012f81a144cad26ca8c7d50d56ec82cbdc9bcde" title="Fulfill the Obligation on Deny decision.">XACML_FULFILLON_DENY</a>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Deny&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a name="a73"></a><a class="code" href="group___x_a_c_m_l.html#gga5f41d6a06e5c9c7c1d540da86e012f81a182004c63512de7d75e8211c87c946d7" title="Fulfill the Obligation on Permit decision.">XACML_FULFILLON_PERMIT</a>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Permit&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;ERROR (Unknown FulfillOn)&quot;</span>;
        <span class="keywordflow">break</span>;
    }
}
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 29 Apr 2014 for Argus PEP client API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
